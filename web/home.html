<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Previ</title>
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body x-data="app">
    <main>
      <h1>Previ</h1>
      <section
        x-intersect.half="onSectionScrolledIntoView('phone')"
        :class="getSectionClass('phone')"
      >
        <h2>Phone</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
      </section>

      <section
        x-intersect.half="onSectionScrolledIntoView('auto')"
        :class="getSectionClass('auto')"
      >
        <h2>Auto Insurance</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
      </section>

      <section
        x-intersect.half="onSectionScrolledIntoView('internet')"
        :class="getSectionClass('internet')"
      >
        <h2>Internet</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
      </section>

      <section
        x-intersect.half="onSectionScrolledIntoView('home')"
        :class="getSectionClass('home')"
      >
        <h2>Home Insurance</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis
          libero officiis voluptate excepturi corrupti debitis quam rem nostrum
          beatae! Vitae earum hic, nostrum esse deleniti autem quos accusantium
          cupiditate eveniet!
        </p>
      </section>
    </main>
    <aside x-cloak x-show="hasWidgetLoaded" x-transition>
      <iframe
        x-ref="widget"
        src="http://localhost:8001"
        frameborder="0"
        @message.window="hasWidgetLoaded = true"
      ></iframe>
    </aside>

    <!-- Alpine Intersect Plugin -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"
    ></script>
    <!-- Alpine Core -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("app", () => ({
          currentSection: "",
          hasWidgetLoaded: false,
          timeout: null, // keeps track of retry handler when iframe hasn't loaded yet.
          onSectionScrolledIntoView(name) {
            if (this.timeout) clearTimeout(this.timeout);

            if (!this.hasWidgetLoaded) {
              // try again - hopefully next time it'll have loaded.
              this.timeout = setTimeout(
                () => this.onSectionScrolledIntoView(name),
                50
              );
            }

            this.currentSection = name;
            this.$refs.widget.contentWindow.postMessage(name);
          },
          getSectionClass(name) {
            return this.currentSection === name ? "active" : "";
          },
        }));
      });
    </script>
  </body>
</html>
